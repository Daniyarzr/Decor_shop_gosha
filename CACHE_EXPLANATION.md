# Система кэширования сайта

## Что такое кэширование?

Кэширование — это сохранение часто используемых данных во временное хранилище для быстрого доступа. Вместо того чтобы каждый раз запрашивать данные из базы данных, система сначала проверяет кэш.

## Как работает система кэширования на сайте

### 1. **Файловое кэширование данных из БД**

Система сохраняет результаты запросов к базе данных в файлы на сервере.

**Что кэшируется:**
- **Слайды главной страницы** — кэш на 30 минут
- **Отзывы** — кэш на 1 час  
- **Акции** — кэш на 15 минут
- **Категории товаров** — кэш на 1 час

**Где хранится:** `cache/data/*.cache`

**Как работает:**
```php
// Пример из index.php
$slides = Cache::get('home_slides');
if ($slides === null) {
    // Если нет в кэше - запрашиваем из БД
    $slides = $pdo->query("SELECT * FROM promo_sliders...")->fetchAll();
    // Сохраняем в кэш на 30 минут
    Cache::set('home_slides', $slides, 1800);
}
```

### 2. **Кэширование статических файлов (CSS, JS, изображения)**

Браузер кэширует статические файлы, чтобы не загружать их повторно.

**Настройки в `.htaccess`:**
- **Изображения** — кэш 1 год
- **CSS/JS** — кэш 1 месяц
- **GZIP-сжатие** — уменьшает размер файлов на 60-80%

**Версионирование:**
```html
<link rel="stylesheet" href="assets/css/style.css?v=1.0.0">
```
При изменении версии браузер загрузит новый файл.

### 3. **Автоматическая очистка кэша**

Кэш автоматически очищается при изменении данных:

- **При изменении товара** → очищается кэш категорий
- **При изменении акции** → очищается кэш акций
- **При изменении отзыва** → очищается кэш отзывов

### 4. **Ручное управление кэшем**

В админ-панели есть раздел **"Кэш"**:
- Просмотр статистики (сколько записей, размер)
- Очистка всего кэша
- Удаление только устаревших записей

## Преимущества

### ✅ Производительность
- **Меньше запросов к БД** — данные берутся из кэша
- **Быстрее загрузка страниц** — особенно при повторных посещениях
- **Меньше нагрузка на сервер** — БД не перегружается

### ✅ Пользовательский опыт
- **Быстрая загрузка** — страницы открываются мгновенно
- **Экономия трафика** — статические файлы кэшируются браузером

### ✅ Масштабируемость
- Система готова к росту трафика
- Можно увеличить время кэширования для статичных данных

## Примеры использования

### Кэширование запроса к БД:
```php
// Без кэша (каждый раз запрос к БД)
$products = $pdo->query("SELECT * FROM products")->fetchAll();

// С кэшем (запрос только если нет в кэше)
$cache_key = 'all_products';
$products = Cache::get($cache_key);
if ($products === null) {
    $products = $pdo->query("SELECT * FROM products")->fetchAll();
    Cache::set($cache_key, $products, 3600); // 1 час
}
```

### Очистка кэша при изменении данных:
```php
// После изменения товара
Cache::delete('catalog_categories'); // Очищаем кэш категорий
```

## Время жизни кэша (TTL)

- **Слайды:** 30 минут (1800 сек) — могут часто меняться
- **Акции:** 15 минут (900 сек) — важны актуальные данные
- **Отзывы:** 1 час (3600 сек) — меняются реже
- **Категории:** 1 час (3600 сек) — меняются редко

## Структура файлов

```
cache/
├── .htaccess          # Запрет доступа к файлам кэша
└── data/
    ├── abc123.cache   # Файлы кэша (md5 хэш ключа)
    └── def456.cache
```

## Безопасность

- Файлы кэша недоступны через браузер (защищено `.htaccess`)
- Кэш исключен из Git (`.gitignore`)
- Автоматическая очистка устаревших записей

## Мониторинг

В админ-панели можно посмотреть:
- Сколько записей в кэше
- Общий размер кэша
- Какие записи устарели
- Когда созданы и когда истекают

---

**Итого:** Система кэширования ускоряет работу сайта в 2-5 раз, снижает нагрузку на БД и улучшает пользовательский опыт.

